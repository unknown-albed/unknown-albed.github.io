name: Update data.json

on:
  issues:
    types: [opened]

jobs:
  update-json:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'

      - name: Update data.json
        run: |
          const fs = require('fs');
          const path = './data.json';
          const issue = process.env.ISSUE;
          const newQA = {
            question: issue.title,
            answer: issue.body
          };

          let data = JSON.parse(fs.readFileSync(path, 'utf8'));
          data.push(newQA);
          fs.writeFileSync(path, JSON.stringify(data, null, 2));

        env:
          ISSUE: ${{ toJson(github.event.issue) }}

      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add data.json
          git commit -m "Update data.json with new Q&A from issue #${{ github.event.issue.number }}"
          git push
